{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyIncorrectEncryptionHeader-Secrets-prd",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets/*",
      "Condition": {
          "StringNotEquals": {
              "s3:x-amz-server-side-encryption-aws-kms-key-id": "arn:aws-us-gov:kms:us-gov-west-1:137377232963:key/97a8fb54-027d-4817-8fb0-66661ec94c7d"
          }
      }
    },
    {
        "Sid": "DenyUnEncryptedObjectUploads-Secrets-prd",
        "Effect": "Deny",
        "Principal": "*",
        "Action": "s3:PutObject",
        "Resource": "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets/*",
        "Condition": {
            "Null": {
                "s3:x-amz-server-side-encryption": true
            }
        }
    },
    {
      "Sid": "DenyUnEncryptedInflightOperations-Secrets-prd",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets/*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    },
    {
      "Sid": "Prevent-Bucket-Deletion-prd",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:DeleteBucket",
      "Resource": "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets"
    },
    {
        "Sid": "Access-to-specific-VPCE-only-Secrets-prd",
        "Effect": "Deny",
        "Principal": "*",
        "Action": [
            "s3:GetObject*",
            "s3:PutObject",
            "s3:DeleteObject*"
        ],
        "Resource": "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets/*",
        "Condition": {
            "StringNotEquals": {
                "aws:sourceVpce": [
                    "vpce-eda66884"
                    ]
            }
        }
    },
    {
        "Sid": "Allow-PowerUser-sks-auto-Access-prd",
        "Effect": "Deny",
        "Principal": "*",
        "Action": "s3:*",
        "Resource": [
           "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets/*",
           "arn:aws-us-gov:s3:::com.vmw.vmc.govcloud.us-gov-west-1.prd.secrets"
        ],
        "Condition": {
            "ArnNotEquals": {
                "aws:PrincipalArn": [
                   "arn:aws-us-gov:iam::137377232963:role/PowerUser",
                    "arn:aws-us-gov:iam::137377232963:role/svc.vmc-gov-auto-prd",
                    "arn:aws-us-gov:iam::137377232963:role/svc.vmc-gov-saas-s3-secrets-ro-prd"
                ]
            }
        }
    }
  ]
}
